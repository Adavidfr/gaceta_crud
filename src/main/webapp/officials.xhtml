<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Gaceta CRUD</title>

        <h:outputStylesheet>
            .col-label {
            width: 20%;
            font-weight: bold;
            vertical-align: middle;
            }

            .col-input {
            width: 80%;
            }

            .acciones-col {
            text-align: center;
            }

            .ui-datatable table {
            table-layout: fixed;
            width: 100%;
            }

            .ui-datatable td {
            word-wrap: break-word;
            white-space: normal;
            }

            /* 游댳 Bloque enviar alineado correctamente */
            .gaceta-envio {
            display: flex;
            align-items: center;
            gap: 12px;
            }

            .gaceta-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
            }

            /* 游댳 Quitar efecto de iluminaci칩n en TODOS los campos */
            .ui-inputfield:focus,
            .ui-inputtextarea:focus,
            .ui-inputnumber input:focus,
            .ui-datepicker input:focus,
            input:focus,
            textarea:focus {
            box-shadow: none !important;
            outline: none !important;
            }

            /* Quitar estilo que PrimeFaces agrega con ui-state-focus */
            .ui-state-focus {
            box-shadow: none !important;
            }


        </h:outputStylesheet>

    </h:head>

    <h:body>
        <h:form id="frm">

            <p:growl id="growl" showDetail="true" life="3000"/>

            <div style="display:flex; flex-direction:column; gap:30px; margin-top: 20px; margin-bottom: 20px">

                <div style="display:flex; justify-content:flex-end;">
                    <h:graphicImage name="logo.png"
                                    library="images"
                                    style="height:45px;" />
                </div>

                <!-- 游댳 BARRA SUPERIOR -->
                <div style="display:flex; justify-content:space-between; align-items:center;">

                    <!-- IZQUIERDA -->
                    <div class="gaceta-envio">

                        <p:commandButton value="Nuevo" icon="pi pi-plus"
                                         actionListener="#{officialBean.nuevo}"
                                         update=":frm:dlg"
                                         oncomplete="PF('dlgW').show()"/>

                        <h:outputText value="N칰mero bolet칤n:"
                                      style="font-weight:bold; color:#555;"/>

                        <p:inputNumber value="#{officialBean.numeroInicial}"
                                       styleClass="no-focus-effect"
                                       style="width:110px"/>
                        <p:commandButton value="Enviar"
                                         icon="pi pi-send"
                                         actionListener="#{officialBean.enviarGaceta}"
                                         update=":frm"
                                         styleClass="btn-enviar"/>
                    </div>

                    <!-- DERECHA -->
                    <div style="display:flex; align-items:center; gap:15px;">

                        <div class="ui-widget"
                             style="display:flex; align-items:center; gap:8px;">

                            <i class="pi pi-user" style="color:#555;"></i>

                            <h:outputText value="Usuario:"
                                          style="font-weight:bold; color:#555;" />

                            <h:outputText value="#{sessionScope.usuarioLogueado}" />

                        </div>

                        <p:commandButton value="Cerrar sesi칩n"
                                         icon="pi pi-sign-out"
                                         action="#{loginBean.logout}"
                                         ajax="false"
                                         styleClass="ui-button-secondary"/>

                    </div>

                </div>

            </div>

            <!-- TABLA -->
            <p:dataTable value="#{officialBean.list}" var="o"
                         paginator="true"
                         paginatorPosition="bottom"
                         rows="5"
                         responsiveLayout="scroll"
                         tableStyle="width:100%; table-layout:fixed;"
                         style="margin-top:10px">

                <p:column headerText="Gaceta No" style="width:7%">
                    <h:outputText value="#{o.publishedOn}"/>
                </p:column>

                <p:column headerText="Fecha" style="width:8%">
                    <h:outputText value="#{o.date}">
                        <f:convertDateTime pattern="yyyy-MM-dd"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Denominaci칩n" style="width:17%">
                    <h:outputText value="#{o.denomination}"/>
                </p:column>

                <p:column headerText="Tr치mite" style="width:17%">
                    <h:outputText value="#{o.applicationNumber}"/>
                </p:column>

                <p:column headerText="Error" style="width:17%">
                    <h:outputText value="#{o.error}"/>
                </p:column>

                <p:column headerText="Correcto" style="width:26%">
                    <h:outputText value="#{o.proper}"/>
                </p:column>

                <p:column headerText="Acciones" 
                          style="width:8%"
                          styleClass="acciones-col">

                    <p:commandButton icon="pi pi-pencil"
                                     title="Editar"
                                     actionListener="#{officialBean.editar(o)}"
                                     update=":frm:dlg"
                                     oncomplete="PF('dlgW').show()"
                                     styleClass="ui-button-text"
                                     style="margin-right:5px"/>

                    <p:commandButton icon="pi pi-trash"
                                     title="Eliminar"
                                     actionListener="#{officialBean.eliminar(o)}"
                                     process="@this"
                                     update=":frm:growl :frm"
                                     styleClass="ui-button-text ui-button-danger">

                        <p:confirm header="Confirmaci칩n"
                                   message="쮼st치s seguro que deseas eliminar el tr치mite #{o.applicationNumber}?"
                                   icon="pi pi-exclamation-triangle"/>

                    </p:commandButton>

                </p:column>

            </p:dataTable>

            <!-- CONFIRM DIALOG -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="S칤" type="button"
                                 styleClass="ui-confirmdialog-yes ui-button-danger"/>
                <p:commandButton value="No" type="button"
                                 styleClass="ui-confirmdialog-no ui-button-secondary"/>
            </p:confirmDialog>

            <!-- DIALOGO -->
            <p:dialog id="dlg" widgetVar="dlgW" header="Aviso Oficial"
                      modal="true" width="900">

                <p:panelGrid columns="2"
                             columnClasses="col-label,col-input"
                             styleClass="ui-fluid"
                             style="width:100%">

                    <h:outputLabel value="Gaceta No:"/>
                    <p:inputText value="#{officialBean.form.publishedOn}"
                                 style="width:100%"/>

                    <h:outputLabel value="Fecha:"/>
                    <p:datePicker value="#{officialBean.form.date}"
                                  pattern="yyyy-MM-dd"
                                  style="width:100%"/>

                    <h:outputLabel value="Denominaci칩n:"/>
                    <p:inputTextarea value="#{officialBean.form.denomination}"
                                     rows="1"
                                     autoResize="false"
                                     style="width:100%"/>

                    <h:outputLabel value="No. de Tr치mite:"/>
                    <p:inputText value="#{officialBean.form.applicationNumber}"
                                 style="width:100%"/>

                    <h:outputLabel value="Con error en:"/>
                    <p:inputTextarea value="#{officialBean.form.error}"
                                     rows="1"
                                     autoResize="false"
                                     style="width:100%"/>

                    <h:outputLabel value="Lo correcto es:"/>
                    <p:inputTextarea value="#{officialBean.form.proper}"
                                     rows="2"
                                     autoResize="false"
                                     style="width:100%"/>

                </p:panelGrid>

                <p:separator/>

                <p:commandButton value="Guardar" icon="pi pi-check"
                                 actionListener="#{officialBean.guardar}"
                                 update=":frm"
                                 oncomplete="PF('dlgW').hide()"
                                 style="width:150px"/>
            </p:dialog>

        </h:form>
    </h:body>
</html>