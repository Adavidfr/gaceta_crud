<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Gaceta CRUD</title>

        <h:outputStylesheet>
            .col-label {
            width: 20%;
            font-weight: bold;
            vertical-align: middle;
            }

            .col-input {
            width: 80%;
            }
        </h:outputStylesheet>

    </h:head>

    <h:body>
        <h:form id="frm">

            <!-- MENSAJES -->
            <p:growl id="growl" showDetail="true" life="3000"/>

            <div style="display:flex; flex-direction:column; gap:30px; margin-top: 20px; margin-bottom: 20px">

                <!-- LOGO  -->
                <div style="display:flex; justify-content:flex-end;">
                    <h:graphicImage name="logo.png"
                                    library="images"
                                    style="height:45px;" />
                </div>

                <!-- USUARIO / LOGOUT -->
                <div style="display:flex; justify-content:space-between; align-items:center;">

                    <!-- IZQUIERDA -->
                    <p:commandButton value="Nuevo" icon="pi pi-plus"
                                     actionListener="#{officialBean.nuevo}"
                                     update=":frm:dlg"
                                     oncomplete="PF('dlgW').show()"/>

                    <!-- DERECHA -->
                    <div style="display:flex; align-items:center; gap:15px;">

                        <div class="ui-widget"
                             style="display:flex; align-items:center; gap:8px;">


                            <i class="pi pi-user" style="color:#555;"></i>

                            <h:outputText value="Usuario:"
                                          style="font-weight:bold; color:#555;" />

                            <h:outputText value="#{sessionScope.usuarioLogueado}" />

                        </div>

                        <p:commandButton value="Cerrar sesión"
                                         icon="pi pi-sign-out"
                                         action="#{loginBean.logout}"
                                         ajax="false"
                                         styleClass="ui-button-secondary"/>

                    </div>

                </div>

            </div>

            <!-- TABLA -->
            <p:dataTable value="#{officialBean.list}" var="o"
                         paginator="true"
                         paginatorPosition="bottom"
                         rows="5"
                         style="margin-top:10px">

                <p:column headerText="Publicado" style="width:120px">
                    <h:outputText value="#{o.publishedOn}"/>
                </p:column>

                <p:column headerText="Fecha" style="width:120px">
                    <h:outputText value="#{o.date}">
                        <f:convertDateTime pattern="yyyy-MM-dd"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Trámite" style="width:150px">
                    <h:outputText value="#{o.applicationNumber}"/>
                </p:column>

                <p:column headerText="Denominación" style="width:500px">
                    <h:outputText value="#{o.denomination}"/>
                </p:column>

                <p:column headerText="Acciones" 
                          style="width:200px"
                          styleClass="acciones-col">


                    <!-- EDITAR -->
                    <p:commandButton value="Editar" icon="pi pi-pencil"
                                     actionListener="#{officialBean.editar(o)}"
                                     update=":frm:dlg"
                                     oncomplete="PF('dlgW').show()"
                                     style="margin-right:8px"/>

                    <!-- ELIMINAR CON CONFIRMACIÓN -->
                    <p:commandButton value="Eliminar" icon="pi pi-trash"
                                     actionListener="#{officialBean.eliminar(o)}"
                                     process="@this"
                                     update=":frm:growl :frm"
                                     styleClass="ui-button-danger"
                                     style="margin-left:5px">

                        <p:confirm header="Confirmación"
                                   message="¿Estás seguro que deseas eliminar el trámite #{o.applicationNumber}?"
                                   icon="pi pi-exclamation-triangle"/>

                    </p:commandButton>




                </p:column>

            </p:dataTable>


            <!-- CONFIRM DIALOG GLOBAL -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sí" type="button"
                                 styleClass="ui-confirmdialog-yes ui-button-danger"/>
                <p:commandButton value="No" type="button"
                                 styleClass="ui-confirmdialog-no ui-button-secondary"/>
            </p:confirmDialog>


            <!-- DIALOGO FORMULARIO -->
            <p:dialog id="dlg" widgetVar="dlgW" header="Aviso Oficial"
                      modal="true" width="900">

                <p:panelGrid columns="2"
                             columnClasses="col-label,col-input"
                             styleClass="ui-fluid"
                             style="width:100%">

                    <h:outputLabel value="Publicado:"/>
                    <p:inputText value="#{officialBean.form.publishedOn}"
                                 style="width:100%"/>

                    <h:outputLabel value="Fecha:"/>
                    <p:datePicker value="#{officialBean.form.date}"
                                  pattern="yyyy-MM-dd"
                                  style="width:100%"/>

                    <h:outputLabel value="Trámite:"/>
                    <p:inputText value="#{officialBean.form.applicationNumber}"
                                 style="width:100%"/>

                    <h:outputLabel value="Denominación:"/>
                    <p:inputTextarea value="#{officialBean.form.denomination}"
                                     rows="4"
                                     autoResize="false"
                                     style="width:100%"/>

                    <h:outputLabel value="Correcto:"/>
                    <p:inputTextarea value="#{officialBean.form.proper}"
                                     rows="3"
                                     autoResize="false"
                                     style="width:100%"/>

                </p:panelGrid>

                <p:separator/>

                <p:commandButton value="Guardar" icon="pi pi-check"
                                 actionListener="#{officialBean.guardar}"
                                 update=":frm"
                                 oncomplete="PF('dlgW').hide()"
                                 style="width:150px"/>
            </p:dialog>

        </h:form>
    </h:body>
</html>
